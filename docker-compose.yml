services:

  namenode:
    image: apache/hadoop:3
    container_name: namenode
    hostname: namenode
    command: ["hdfs", "namenode"]
    ports:
      - "9870:9870"
      - "9000:9000"
    volumes:
      - ./scripts:/opt/scripts      # ‚Üê important
      # - ./flume:/opt/flume
      # - ./mapreduce:/opt/mapreduce
      # - ./mysql/setup_mysql.sql:/opt/scripts/setup_mysql.sql
    env_file:
      - ./hadoop.env
    environment:
      ENSURE_NAMENODE_DIR: "/tmp/hadoop-root/dfs/name"
    networks:
      - hadoop

  datanode:
    image: apache/hadoop:3
    container_name: datanode
    command: ["hdfs", "datanode"]
    env_file:
      - ./hadoop.env
    depends_on:
      - namenode
    networks:
      - hadoop

  resourcemanager:
    image: apache/hadoop:3
    container_name: resourcemanager
    command: ["yarn", "resourcemanager"]
    ports:
      - "8088:8088"
    env_file:
      - ./hadoop.env
    depends_on:
      - namenode
    networks:
      - hadoop

  nodemanager:
    image: apache/hadoop:3
    container_name: nodemanager
    command: ["yarn", "nodemanager"]
    env_file:
      - ./hadoop.env
    depends_on:
      - resourcemanager
    networks:
      - hadoop

  mysql:
    image: mysql:8.0
    container_name: mysql
    ports:
      - "3306:3306"
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: bigdata
      MYSQL_USER: bduser
      MYSQL_PASSWORD: bdpass
    volumes:
      - mysql_data:/var/lib/mysql
      - ./mysql/setup_mysql.sql:/docker-entrypoint-initdb.d/setup_mysql.sql
    networks:
      - hadoop

networks:
  hadoop:

volumes:
  mysql_data: